var __reflect=this&&this.__reflect||function(t,e,o){t.__class__=e,o?o.push(e):o=[e],t.__types__=t.__types__?o.concat(t.__types__):o},__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},__awaiter=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{c(i.next(t))}catch(e){n(e)}}function a(t){try{c(i["throw"](t))}catch(e){n(e)}}function c(t){t.done?r(t.value):new o(function(e){e(t.value)}).then(s,a)}c((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(s=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[0,s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(i){o=[6,i],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return{next:o(0),"throw":o(1),"return":o(2)}},__assign=this&&this.__assign||Object.assign||function(t){for(var e,o=1,i=arguments.length;i>o;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},__decorate=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=3>n?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(3>n?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s},com;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.init(),e.includeInLayout=!1,e.cacheAsBitmap=!0,e}return __extends(e,t),e.prototype.init=function(){this.r1=new eui.Image,this.r1.source="rect_0_png",this.r1.y=10,this.r1.horizontalCenter=0,this.r2=new eui.Image,this.r2.source="rect_1_png",this.r2.y=28,this.r3=new eui.Image,this.r3.source="rect_1_png",this.addChild(this.r1),this.addChild(this.r2),this.addChild(this.r3)},e.prototype.setSize=function(t){this.r1.width=t-6,this.r2.width=this.r3.width=t},e}(eui.Group);t.Rect=e,__reflect(e.prototype,"com.Rect")}(com||(com={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,o){function i(i){e.call(o,i,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?i(r):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var com;!function(t){var e=function(t){function e(){var o=t.call(this)||this;return o.includeInLayout=!1,o.fillColor=16372108,o.height=69,o.anchorOffsetY=69*e.offset,o}return __extends(e,t),e.prototype.show=function(t){var o=this;this.alpha=1,this.rotation=0;var i=t.x,r=t.y,n=t.w,s=t.dir;this.width=n,this.y=r-69*(1-e.offset);var a;"left"===s?(this.anchorOffsetX=this.width*e.offset,this.x=i-n+this.anchorOffsetX,a=-200):(this.anchorOffsetX=this.width*(1-e.offset),this.x=i+this.anchorOffsetX,a=200),egret.Tween.get(this).wait(200).to({rotation:a,y:r+200,alpha:0},1e3).call(function(){o.parent&&o.parent.removeChild(o)})},e}(eui.Rect);e.offset=.8,t.DropRect=e,__reflect(e.prototype,"com.DropRect")}(com||(com={}));var com;!function(t){var e=function(t){function e(){var o=t.call(this)||this;return o.gameInfo={bestScore:0,score:0,gold:0},o.info={scrollV:0,emptyBlockHeight:0,isShowFrontBg:!1},o.collection=new eui.ArrayCollection([]),new model.Data,o.info.emptyBlockHeight=895-69*e.STLAYER,o.addEventListener(eui.UIEvent.COMPLETE,o.onComplete,o),o.skinName="resource/eui_skins/home.exml",o}return __extends(e,t),e.prototype.onComplete=function(){new Manager(this)},e.prototype.setGoldNum=function(t){this.gameInfo.gold=t},e.prototype.render=function(t){return __awaiter(this,void 0,void 0,function(){var e,o,i,r,n;return __generator(this,function(s){switch(s.label){case 0:if(e=t.List,o=t.BestScore,i=e.length,r=this.collection.length,n="add",i){if(i===r)return[2];i===r+1?(this.collection.addItemAt(e[r],0),n="add"):i===r-1?(this.collection.removeItemAt(0),n="minus"):this.collection=new eui.ArrayCollection(e.reverse())}else this.collection.length&&this.collection.removeAll(),n="minus";return[4,this.scrollAnim(n)];case 1:return s.sent(),this.info.isShowFrontBg=!i,this.gameInfo.score=i,this.gameInfo.bestScore=o,[2]}})})},e.prototype.scrollAnim=function(t){return __awaiter(this,void 0,void 0,function(){var o,i=this;return __generator(this,function(r){switch(r.label){case 0:if(o=this.collection.length,"add"===t){if(o<=e.STLAYER)return[2,Promise.resolve()];this.info.scrollV=69}else if(o>=e.STLAYER||0===o)this.info.scrollV=-69;else if(o>0)return[2,Promise.resolve()];return[4,new Promise(function(t,e){egret.Tween.get(i.info).to({scrollV:0},400).call(t)})];case 1:return r.sent(),[2]}})})},e}(eui.Component);e.STLAYER=7,t.Game=e,__reflect(e.prototype,"com.Game")}(com||(com={}));var com;!function(t){function e(t,e){return new particle.GravityParticleSystem(RES.getRes(e),RES.getRes(t))}var o=function(t){function o(){var o=t.call(this)||this;return o.effect=e("effect_particle_json","star_0_png"),o.addChild(o.effect),o.note=new egret.Bitmap,o.addChild(o.note),o}return __extends(o,t),o.prototype.show=function(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,function(){var e,o,i,r,n,s,a,c=this;return __generator(this,function(l){switch(l.label){case 0:return this.alpha=1,e=t.type,o=void 0===e?"perfect":e,i=t.w,r=void 0===i?200:i,n=t.time,s=void 0===n?500:n,"perfect"===o?(a="star_0_png",this.note.texture=RES.getRes("perfect_png")):(a="star_1_png",this.note.texture=RES.getRes("good_png")),this.note.anchorOffsetX=this.note.width>>1,this.note.anchorOffsetY=this.note.height>>1,this.note.scaleX=this.note.scaleY=this.note.alpha=0,this.effect.changeTexture(RES.getRes(a)),this.effect.emitterXVariance=r,this.effect.maxParticles=r/10|0,this.effect.start(s),[4,new Promise(function(t,e){egret.Tween.get(c.note).to({alpha:1,scaleX:1,scaleY:1},200).to({alpha:0},s-200).call(t)})];case 1:return l.sent(),this.parent&&this.parent.removeChild(this),[2]}})})},o}(egret.Sprite);t.Particle=o,__reflect(o.prototype,"com.Particle")}(com||(com={}));var com;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.gap=0,e._props={},e.collection=new eui.ArrayCollection([]),e}return __extends(e,t),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},set:function(t){this._props=__assign({},this.props,t),t&&"pillar"===t.type&&(this.render(),this.addStuff())},enumerable:!0,configurable:!0}),e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.render=function(){this.collection.removeAll();var t=this._props,e=t.w;t.x;if(!(33>e)){for(var o=Math.floor(e/33),i=o-1>0?e%33/(o-1):0,r=0;o>r;r++)this.collection.addItem({icon:"pillar_1_png"});this.gap=i}},e.prototype.addStuff=function(){if(this.container){this.container.numChildren&&this.container.removeChildren();for(var t=["cacti_png","grass_png","greenstripes_png","pinkbubbles_png","rabit_png"],e=this.collection.length*Math.random()|0,o=0,i=void 0;e>o;o++)i=new eui.Image,Math.random()>.5?(i.source=t[Math.random()*t.length|0],i.bottom=0):i.source="cuimianshu_png",i.x=Math.random()*this._props.w|0,this.container.addChild(i)}},e}(eui.Component);t.Pillar=e,__reflect(e.prototype,"com.Pillar",["eui.UIComponent","egret.DisplayObject"])}(com||(com={}));var com;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._props={},e.info={w1:0,w2:0,w3:0,x1:0,x2:0,x3:0},e}return __extends(e,t),Object.defineProperty(e.prototype,"props",{get:function(){return this._props},set:function(t){this._props=__assign({},this.props,t);var e=this._props,o=e.w,i=e.x;this.info.w1=o-6,this.info.w2=o,this.info.w3=o-12,this.info.x3=o-10,this.info.x1=i,this.info.x2=i+6},enumerable:!0,configurable:!0}),e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);t.Block=e,__reflect(e.prototype,"com.Block",["eui.UIComponent","egret.DisplayObject"])}(com||(com={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.stage.addChild(new com.Game)},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Manager=function(){function t(t){var e=this;this._moveInterval=0,this.dir=5,this.game=t,this.rect=new com.Rect,this.particle=new com.Particle,this.game.scroll.viewport.addChild(this.rect),mobx.autorun(function(){e.render()}),mobx.autorun(function(){e.game.setGoldNum(model.Data.ins.GoldNum)}),mobx.autorun(function(){e.toggleGame()}),this.initEvent()}return t.prototype.render=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.rect&&(this.rect.visible=!1),[4,this.game.render(model.Data.ins)];case 1:return e.sent(),this.rect.y=this.getMoveRectY()-69,t=this.getMoveRectSize(),this.rect.setSize(t),this.rect.visible=!0,Math.random()>=.5?(this.rect.x=750-t,this.dir=-5):(this.rect.x=0,this.dir=5),[2]}})})},t.prototype.toggleGame=function(){var t=model.Data.ins.Status;return"stop"===t?(egret.clearInterval(this._moveInterval),this.rect.visible=!1,this.game.undoBtn.visible=!1,this.game.keepBtn.visible=!0,void(this.game.eventLayer.visible=!1)):"playing"===t?(this.game.undoBtn.visible=!0,this.game.keepBtn.visible=!1,this.game.eventLayer.visible=!0,void(this._moveInterval=egret.setInterval(this.runGame,this,16))):void 0},t.prototype.runGame=function(){this.rect&&(this.rect.x+=this.dir,(this.rect.x<=0||this.rect.x+this.rect.width>=750)&&(this.dir=-1*this.dir))},t.prototype.initEvent=function(){this.game.undoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUndo,this),this.game.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this),this.game.keepBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onKeep,this),this.game.eventLayer.addEventListener(egret.TouchEvent.TOUCH_TAP,this.play,this)},t.prototype.getMoveRectY=function(){var t=model.Data.ins.List.length;return t?t<com.Game.STLAYER?895-69*t:895-69*com.Game.STLAYER:895},t.prototype.getMoveRectSize=function(){var t=model.Data.ins.List.length;return t?model.Data.ins.List[t-1].props.w:364},t.prototype.onUndo=function(){model.Data.ins.GoldNum<100||0===model.Data.ins.List.length||(model.Data.ins.pop(),model.Data.ins.addGold(-100))},t.prototype.play=function(){if(this.rect.visible){var t=this.getNewLayerInfo(),e=t.x,o=t.w,i=t.status,r=t.dir;if(0>=o)return model.Data.ins.setBest(),void model.Data.ins.setStatus("stop");if(model.Data.ins.List.length%2===0||66>o){var n=Math.random()>.6;model.Data.ins.add({props:{x:e,w:o,type:"block",isShowFlag:n},isb:!0})}else model.Data.ins.add({props:{x:e,w:o,type:"pillar"},isp:!0});var s=new com.DropRect,a=this.getParticlePosAndSize();this.game.scroll.viewport.addChild(s),s.show({x:"left"===r?this.rect.x+this.rect.width-o:this.rect.x+o,y:a.y,w:this.rect.width-o,dir:r}),i>1?(this.showParticle(a.x,a.y,{w:a.w,type:3===i?"perfect":"good"}),model.Data.ins.addGold(3===i?30:20)):model.Data.ins.addGold(10)}},t.prototype.onRestart=function(){model.Data.ins.clear(),model.Data.ins.setStatus("playing")},t.prototype.onKeep=function(){if(!(model.Data.ins.GoldNum<500)){var t=model.Data.ins.List.slice();t=t.reverse();for(var e=0,o=t.length;o>e;e++)if(t[e].props.w>=182){model.Data.ins.splice(t.length-e-1),model.Data.ins.setStatus("playing");break}model.Data.ins.addGold(-500)}},t.prototype.getNewLayerInfo=function(){var t=model.Data.ins.List,e={};if(t.length){var o=t[t.length-1];e.x=o.props.x,e.w=o.props.w}else e.x=0,e.w=364;var i,r=this.rect.x-(193+e.x),n=0;r>=0?(n=e.w-r,r=e.x+r,i="right"):(n=e.w+r,r=e.x,i="left"),n=n>10?n:0;var s=1;return n>=.95*e.w?s=3:n>=.9*e.w&&(s=2),{x:r,w:n,status:s,dir:i}},t.prototype.showParticle=function(t,e,o){this.game.scroll.viewport.addChild(this.particle),this.particle.x=t,this.particle.y=e,this.particle.show(o)},t.prototype.getParticlePosAndSize=function(){var t=model.Data.ins.List,e=t.length;if(e){var o=t[e-1],i=e<=com.Game.STLAYER?895-69*(e-1):895-69*(com.Game.STLAYER-1),r=o.props.w/2,n=193+r+o.props.x;return{x:n,y:i,w:r}}return{}},t}();__reflect(Manager.prototype,"Manager");var model;!function(t){function e(t,e){localStorage.setItem(t,e)}function o(t){var e=localStorage.getItem(t)||"0";return parseInt(e)}var i=function(){function t(){this.List=[],this.Status="playing",this.BestScore=0,this.GoldNum=0,t.ins=this,this.setBest(),this.addGold(0)}return t.prototype.add=function(t){this.List.push(t)},t.prototype.pop=function(){return this.List.pop()},t.prototype.clear=function(){this.List.splice(0)},t.prototype.splice=function(t){this.List.splice(t)},t.prototype.setStatus=function(t){this.Status=t},t.prototype.setBest=function(){var i=Math.max(o(t.SCORE_KEY),this.List.length);e(t.SCORE_KEY,i),this.BestScore=i},t.prototype.addGold=function(i){var r=o(t.GOLD_KEY);r=Math.max(0,r+i),this.GoldNum=r,e(t.GOLD_KEY,r)},t}();i.SCORE_KEY="ttt_best_score",i.GOLD_KEY="ttt_gold",__decorate([mobx.observable],i.prototype,"List",void 0),__decorate([mobx.observable],i.prototype,"Status",void 0),__decorate([mobx.observable],i.prototype,"BestScore",void 0),__decorate([mobx.observable],i.prototype,"GoldNum",void 0),__decorate([mobx.action.bound],i.prototype,"add",null),__decorate([mobx.action.bound],i.prototype,"pop",null),__decorate([mobx.action.bound],i.prototype,"clear",null),__decorate([mobx.action.bound],i.prototype,"splice",null),__decorate([mobx.action.bound],i.prototype,"setStatus",null),__decorate([mobx.action.bound],i.prototype,"setBest",null),__decorate([mobx.action.bound],i.prototype,"addGold",null),t.Data=i,__reflect(i.prototype,"model.Data")}(model||(model={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,o,i){function r(t){e.call(i,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),o.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);